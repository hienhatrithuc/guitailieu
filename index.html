<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iMessage-like Chat</title>
<style>
    body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        background-color: #dcdcdc;
        margin: 0;
        padding: 0;
    }
    .chat-container {
        max-width: 500px;
        margin: 20px auto;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        background-color: #fff;
    }
    .chat-header {
        background-color: #007aff;
        color: #fff;
        padding: 15px;
        text-align: center;
        font-size: 18px;
        font-weight: bold;
    }
    .chat-messages {
        padding: 20px;
        overflow-y: scroll;
        max-height: 400px;
        background-color: #f9f9f9;
    }
    .message {
        display: block;
        margin: 10px 0;
        padding: 10px 15px;
        border-radius: 20px;
        clear: both;
        position: relative;
        max-width: 70%;
        word-wrap: break-word;
    }
    .message.sender {
        background-color: #007aff;
        color: #fff;
        float: right;
    }
    .message.receiver {
        background-color: #e5e5ea;
        color: #000;
        float: left;
    }
    .message-input {
        display: flex;
        padding: 10px;
        background-color: #f2f2f2;
        border-top: 1px solid #ccc;
    }
    .message-input input[type="text"] {
        flex: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 20px;
        outline: none;
        font-size: 16px;
        margin-right: 10px;
    }
    .message-input input[type="submit"] {
        background-color: #007aff;
        color: #fff;
        border: none;
        border-radius: 20px;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 16px;
        outline: none;
    }
</style>
</head>
<body>
<div class="chat-container">
    <div class="chat-header">
        Tin nhắn (tự động xóa sau 1 ngày)
    </div>
    <div class="chat-messages" id="chatMessages">
        <!-- Chat messages will be added dynamically here -->
    </div>
    <div class="message-input">
        <input type="text" id="messageInput" placeholder="Nhập tin nhắn của bạn...">
        <input type="submit" value="Gửi" onclick="sendMessage()">
    </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.8.0/firebase-database-compat.js"></script>

<script>
    // Your Firebase configuration
    var firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
        databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT_ID.appspot.com",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    var database = firebase.database();

    document.addEventListener('DOMContentLoaded', function() {
        loadMessages();
    });

    function sendMessage() {
        var messageInput = document.getElementById('messageInput');
        var message = messageInput.value.trim();
        if (message !== '') {
            var now = new Date();
            var time = now.toLocaleString(); // Format: ngày/tháng/năm, giờ:phút:giây
            var senderName = generateSenderName();
            var messageData = {
                message: message,
                timestamp: now.getTime(), // Store message timestamp as milliseconds since Unix epoch
                sender: senderName
            };

            // Save message to Firebase
            database.ref('messages').push(messageData);

            messageInput.value = '';
        }
    }

    function loadMessages() {
        var chatMessages = document.getElementById('chatMessages');

        // Listen for new messages added to Firebase
        database.ref('messages').on('child_added', function(snapshot) {
            var item = snapshot.val();
            var messageDiv = document.createElement('div');
            var timestamp = new Date(item.timestamp);
            var time = timestamp.toLocaleString(); // Format: ngày/tháng/năm, giờ:phút:giây
            messageDiv.textContent = '[' + time + '] ' + item.sender + ': ' + item.message; // Add time, sender name, and message
            messageDiv.classList.add('message', 'sender');
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });

        // Listen for messages removed from Firebase
        database.ref('messages').on('child_removed', function(snapshot) {
            var messages = document.querySelectorAll('.message');
            messages.forEach(function(messageDiv) {
                if (messageDiv.textContent.includes(snapshot.val().message)) {
                    chatMessages.removeChild(messageDiv);
                }
            });
        });

        // Periodically remove messages older than 1 day
        setInterval(function() {
            var cutoff = Date.now() - 86400000; // 1 day in milliseconds
            var oldMessages = database.ref('messages').orderByChild('timestamp').endAt(cutoff);
            oldMessages.once('value', function(snapshot) {
                snapshot.forEach(function(childSnapshot) {
                    database.ref('messages/' + childSnapshot.key).remove();
                });
            });
        }, 60000); // Check every 60 seconds
    }

    function generateSenderName() {
        var ip = Math.floor(Math.random() * 256) + '.' + Math.floor(Math.random() * 256) + '.' + Math.floor(Math.random() * 256) + '.' + Math.floor(Math.random() * 256);
        return 'User_' + ip.replace(/\./g, '_');
    }
</script>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyBMKrnG-nzEhIl9f5lVIp4U241-RGp4bEc",
    authDomain: "hsdiary-aec7c.firebaseapp.com",
    projectId: "hsdiary-aec7c",
    storageBucket: "hsdiary-aec7c.appspot.com",
    messagingSenderId: "183436935187",
    appId: "1:183436935187:web:de598624b222fd483c3fe6",
    measurementId: "G-ZQHJJHZXBG"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>
</body>
</html>
